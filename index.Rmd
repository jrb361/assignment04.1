---
title: "Assignment #4"
author: "Julia Buschmann | jrb361"
date: "2/26/2022"
output: pdf_document
urlcolor: blue
source: https://usa.ipums.org/usa-action/data_requests/download
---

Aesthetic mappings: x position, y position, line type, colors, transparency
Non-aesthetic mappings: outside aes, like theme minimal, facet wrap

To commit to Github:git add (file), git commit -m "comment", git push origin main

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(echo = TRUE)
```

```{r include = FALSE}
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
```

```{r}
library(tidyverse)
library(haven)
library(ipumsr)
library(ggplot2)
library(dplyr)
library(srvyr)
library(grid)
theme_set(theme_classic())
```


```{r, results = 'hide'}
ddi <- read_ipums_ddi("cps_00002.xml")
data <- read_ipums_micro(ddi)
```


### Visualization #1
The below graph depicts the enrollment in Medicaid, differentiated by sex, for years 2016 through 2021. In each year, more women than men are enrolled in Medicaid, which could occur for a few reasons. Many states have family planning "demonstrations" which create a new eligibility group so women that are above the normal income limit for Medicaid can access contraception, exams, and fertility preservation services. Further, all states allow for income-eligible pregnant women to enroll in Medicaid (though their income limits differ dramatically, from 30% FPL to 138% FPL). Moreover, women typically work lower paying jobs than men, meaning that there are more likely to be eligible for Medicaid in all states. 

```{r}
data %>%
  group_by(YEAR) %>%
  filter (HIMCAIDLY == 2) %>%
  mutate(
    Sex = case_when(
      SEX == 1 ~ "Male",
      SEX == 2 ~ "Female"
    ))%>%
  ggplot +
  geom_bar(mapping = aes(x = factor(YEAR), fill = factor(Sex)), position = "dodge") +
  labs(title="Medicaid Enrollment By Year, Differentiated By Sex", 
       caption="Source: IPUMS Micro Data",
       x = "Year",
       y = "Number of People Enrolled",
       fill = "Sex")
```

\newpage

### Visualization #2
A histogram demonstrating the age of Medicaid enrollees. Unsurprisingly, we see that the majority of enrollees are younger than 18. More than half of all births in the US are among Medicaid enrollees, and in some states, kids at certain income levels are eligible for various programs (e.g., the Children's Health Insurance Program) when their parents may not be.
```{r}
data %>%
  filter(YEAR == 2021) %>%
  filter(AGE <= 79)%>%
  filter(HIMCAIDLY == 2) %>%
  ggplot +
  geom_histogram(aes(x = AGE), 
                 binwidth = .1)+
  labs(title="Number of individuals enrolled in Medicaid, by Age, in 2021", 
       subtitle = "Due to coding methods, an accurate count of individuals 80 years and older is not available. 
       They have been excluded from the below graph.",
       caption="Source: IPUMS Micro Data",
       x = "Age of Medicaid Enrollee",
       y = "Number of People Enrolled (thousands)")

```

\newpage 

### Visualization #3
The below visualization demonstrates enrollment in private insurance, and the purchase of marketplace plans, varies by age. There is a steep increase in private coverage, and marketplace plans, among 19 to 20 year olds that declines around age 25 or 26. This could indicate 

Unsurprisingly, enrollment in employer-sponsored insurance tracks closely with enrollment in private insurance. The difference between the two indicates that individuals are purchasing other sources of private insurance, such as the health insurance marketplace.

```{r}
data %>%
  filter(OFFPOV == 01)%>%
  filter(YEAR == 2021)%>%
  filter(PRVTCOVNW == 2 | GRPCOVNW == 2)%>%
  filter(AGE <= 79)%>%
  group_by(AGE)%>%
  summarize(PRVTCOVNW = sum(PRVTCOVNW), GRPCOVNW = sum(GRPCOVNW))%>%
  ggplot +
  geom_col(mapping = aes(x = AGE, y = PRVTCOVNW, fill = "skyblue"))+
  labs(title = "Enrollment in Private Health Insurance and Employer-Sponsored Insurance, 
       by Age, in 2021", 
       subtitle = "This graph includes",
       caption="Source: IPUMS Micro Data",
       x = "Age of Policy Holder",
       y = "Number of Individuals (thousands)") +
  geom_point(mapping = aes(x = AGE, y = GRPCOVNW, fill = "black"))

```

\newpage

### Visualization #4
The below visualization demonstrates the how type of insurance coverage varied throughout 2021. 

```{r}
data%>%
  filter(EMPSTAT == 21)%>%
  filter(YEAR == 2021)%>%
  mutate(
    month = case_when(
      MONTH == 01 ~ "January",
      MONTH == 02 ~ "February",
      MONTH == 03 ~ "March", 
      MONTH == 04 ~ "April",
      MONTH == 05 ~ "May",
      MONTH == 06 ~ "June",
      MONTH == 07 ~ "July",
      MONTH == 08 ~ "August", 
      MONTH == 09 ~ "September", 
      MONTH == 10 ~ "October", 
      MONTH == 11 ~ "November",
      MONTH == 12 ~ "December"
    ))%>%
  mutate(month = ordered(month, levels = unique(month))) %>%
  mutate(
    Race = case_when(
      RACE == 100 ~ "White",
      RACE == 200 ~ "Black",
      RACE == 300 ~ "American Indian/Alaska Native",
      RACE == 650 ~ "Asian/Pacific Islander",
      RACE == 651 ~ "Asian",
      RACE >= 801 & RACE <= 830 ~ "Two or More Races"
    ))%>%
  group_by(month, Race)%>%
  summarize(n = n())%>%
  ggplot +
  geom_point(mapping = aes(x = month, y = n, fill = Race, color = Race))+
  labs(title = "The Demographics of Unemployment in 2021", 
       subtitle = "The below graph shows the unemployment rate of experienced workers. New workers 
       also experienced a high rate of unemployment, with a similar demographic trend as 
       experienced workers.",
       x = "Month",
       y = "Number of Individuals (thousands)", 
       caption = "Source: IPUMS Micro Data")+
  geom_smooth(method = lm, se = FALSE, aes(x = month, y = n, color = Race))+
  geom_line(mapping = aes(x = month, y = n, fill = Race, color = Race))+
  theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust=1))

```

